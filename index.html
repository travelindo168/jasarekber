<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JB JUAN STORE - Top Up & Rekber</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background:#f7f7f9; font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }
    .banner{ background: linear-gradient(90deg,#6f42c1,#0d6efd); color:#fff; padding:14px 12px; }
    .card{ border-radius:12px; }
    .menu-btn{ min-height:64px; }
    @media (min-width:576px){ .container-sm{ max-width:420px; } }
    .small-muted{ font-size:.85rem; color: rgba(255,255,255,.95); }
    /* Make modal inputs full width on very small screens */
    .modal .form-control, .modal .input-group { width:100%; }
  </style>
</head>
<body>
  <div class="container-sm px-2 pt-3">
    <div class="banner d-flex align-items-center justify-content-between rounded-3 mb-3">
      <div>
        <h5 class="mb-0">JB JUAN STORE</h5>
        <small class="small-muted">Top Up Game & Layanan Rekber</small>
      </div>
      <div class="text-end">
        <small class="d-block small-muted">Transaksi Rekber</small>
        <button class="btn btn-light btn-sm" data-bs-toggle="modal" data-bs-target="#rekberChoiceModal">Buka</button>
      </div>
    </div>

    <div class="card p-3 mb-3">
      <h6>Menu Cepat</h6>
      <div class="row g-2 mt-2">
        <div class="col-6">
          <button class="btn btn-outline-primary w-100 menu-btn" data-bs-toggle="modal" data-bs-target="#rekberChoiceModal">Rekber</button>
        </div>
        <div class="col-6">
          <a class="btn btn-outline-success w-100 menu-btn" href="#">Top Up Game</a>
        </div>
        <div class="col-6">
          <a class="btn btn-outline-secondary w-100 menu-btn" href="#">Jual/Beli Akun</a>
        </div>
        <div class="col-6">
          <a class="btn btn-outline-warning w-100 menu-btn" href="#">Bantuan</a>
        </div>
      </div>
    </div>

    <div class="card p-3 mb-5">
      <h6>Info</h6>
      <p class="mb-0 small">Pilih Rekber untuk memulai transaksi aman. Untuk pertanyaan cepat, hubungi admin melalui WhatsApp.</p>
    </div>
  </div>

  <!-- Rekber Choice Modal -->
  <div class="modal fade" id="rekberChoiceModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Pilih Opsi Rekber</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="d-grid gap-2">
            <a id="rekberFbBtn" class="btn btn-primary" target="_blank" href="https://www.facebook.com/bangjuan168?mibextid=ZbWKwL">Rekber via Facebook</a>
            <button class="btn btn-success" data-bs-target="#rekberWaModal" data-bs-toggle="modal" data-bs-dismiss="modal">Rekber via WhatsApp Admin</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Rekber WA Modal (Form) -->
  <div class="modal fade" id="rekberWaModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Form Transaksi Rekber (WA)</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <form id="rekberForm">
          <div class="modal-body">
            <div class="mb-2">
              <label class="form-label small">Nomor WA Seller</label>
              <input type="tel" class="form-control" id="sellerWa" placeholder="62821xxxx (tanpa +)" required>
            </div>

            <div class="mb-2">
              <label class="form-label small">Nomor WA Buyer</label>
              <input type="tel" class="form-control" id="buyerWa" placeholder="62821xxxx (tanpa +)" required>
            </div>

            <div class="mb-2">
              <label class="form-label small">Nilai Transaksi (Rp)</label>
              <input class="form-control" id="nilai" placeholder="100000" inputmode="numeric" required>
            </div>

            <div class="mb-2">
              <label class="form-label small">Deskripsi Produk</label>
              <textarea class="form-control" id="deskripsi" rows="2" placeholder="Misal: akun FF level 50 + skin"></textarea>
            </div>

            <div class="mb-2">
              <label class="form-label small">Fee Rekber</label>
              <div class="input-group">
                <span class="input-group-text">Rp</span>
                <input type="text" class="form-control" id="fee" readonly>
              </div>
            </div>

            <div class="mb-2">
              <label class="form-label small">Total yg harus dibayar Buyer</label>
              <div class="input-group">
                <span class="input-group-text">Rp</span>
                <input type="text" class="form-control" id="totalBayar" readonly>
              </div>
            </div>

            <div class="form-text small">Pastikan nomor WA seller & buyer benar. Tombol Kirim akan membuka chat WA admin dengan ringkasan transaksi.</div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
            <button type="submit" class="btn btn-primary">Kirim Transaksi ke Admin (WA)</button>
          </div>
        </form>

      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // wait DOM
    document.addEventListener('DOMContentLoaded', function() {
      const nilaiInput = document.getElementById('nilai');
      const feeInput = document.getElementById('fee');
      const totalInput = document.getElementById('totalBayar');
      const form = document.getElementById('rekberForm');

      function parseRupiahToInt(v) {
        if (!v) return 0;
        return parseInt(String(v).replace(/[^0-9]/g, '' ) || '0', 10);
      }

      function formatRupiah(n) {
        if (n === null || n === undefined) return '0';
        const num = Number(n);
        if (!isFinite(num)) return '0';
        return Math.round(num).toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
      }

      function calculateFee(amount){
        // contiguous, no gaps
        if (amount >= 10000 && amount <= 50000) return 3000;
        if (amount >= 50001 && amount <= 100000) return 5000;
        if (amount >= 100001 && amount <= 499999) return 10000;
        if (amount >= 500000 && amount <= 1000000) return 15000;
        if (amount >= 1000001 && amount <= 5000000) return 20000;
        if (amount >= 5000001 && amount <= 10000000) return 40000;
        if (amount >= 10000001 && amount <= 50000000) return 50000;
        if (amount > 50000000) return 50000;
        return 0;
      }

      // live update
      nilaiInput.addEventListener('input', function(){
        const val = parseRupiahToInt(nilaiInput.value);
        const fee = calculateFee(val);
        feeInput.value = fee ? formatRupiah(fee) : '0';
        totalInput.value = (val || 0) ? formatRupiah(val + fee) : '0';
      });

      // submit
      form.addEventListener('submit', function(e){
        e.preventDefault();
        const seller = document.getElementById('sellerWa').value.trim();
        const buyer = document.getElementById('buyerWa').value.trim();
        const nilai = parseRupiahToInt(document.getElementById('nilai').value);
        const deskripsi = document.getElementById('deskripsi').value.trim();
        const fee = calculateFee(nilai);

        if (!seller || !buyer || !nilai) {
          alert('Lengkapi semua field (Nomor seller, buyer, dan nilai transaksi).');
          return;
        }

        const adminNumber = '6289531332329';
        const plainMsg =
          'Rekber Request\\n' +
          '---------------\\n' +
          'Seller: ' + seller + '\\n' +
          'Buyer: '  + buyer  + '\\n' +
          'Nilai: Rp ' + formatRupiah(nilai) + '\\n' +
          'Fee: Rp ' + formatRupiah(fee) + '\\n' +
          'Total Bayar: Rp ' + formatRupiah(nilai + fee) + '\\n' +
          'Deskripsi: ' + deskripsi;

        const encoded = encodeURIComponent(plainMsg);
        const waUrl = 'https://wa.me/' + adminNumber + '?text=' + encoded;

        window.open(waUrl, '_blank');

        // close modal
        const el = document.getElementById('rekberWaModal');
        const modal = bootstrap.Modal.getOrCreateInstance(el);
        try { modal.hide(); } catch (err) { /* ignore */ }
      });

      // init values
      feeInput.value = '0';
      totalInput.value = '0';
    });
  </script>
</body>
</html>
